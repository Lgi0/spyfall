<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camale√£o do Gigio</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); 
            color: #fff; 
            padding: 15px; 
            min-height: 100vh; 
        }
        
        .container { 
            max-width: 420px; 
            margin: 0 auto; 
            padding: 10px; 
        }
        
        .screen { 
            display: none; 
            text-align: center; 
            min-height: 100vh; 
        }
        
        .screen.active { 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
        }
        
        /* Toggle Switch para Modo Surpresa */
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            font-size: 16px;
            gap: 12px;
        }
        
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 34px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #666;
            transition: 0.3s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background: linear-gradient(135deg, #ff4757, #ff3838);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .modo-surpresa {
            color: #ff6b7a;
            font-weight: bold;
            text-shadow: 0 1px 5px rgba(255,107,122,0.5);
        }
        
        /* Inputs e bot√µes mobile otimizados */
        input[type="number"] { 
            width: 100%; 
            max-width: 300px; 
            padding: 18px 16px; 
            margin: 12px 0; 
            font-size: 18px; 
            border: none; 
            border-radius: 12px; 
            background: #16213e; 
            color: white; 
            text-align: center; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        input[type="number"]::placeholder { 
            color: #aaa; 
        }
        
        button { 
            background: linear-gradient(135deg, #ff4757, #ff3838); 
            color: white; 
            border: none; 
            padding: 18px 35px; 
            font-size: 18px; 
            font-weight: bold; 
            border-radius: 12px; 
            cursor: pointer; 
            margin: 12px; 
            min-width: 60px; 
            box-shadow: 0 6px 20px rgba(255,71,87,0.4);
            transition: all 0.2s;
        }
        
        button:hover:not(:disabled), 
        button:active:not(:disabled) { 
            transform: translateY(-2px); 
            box-shadow: 0 8px 25px rgba(255,71,87,0.5); 
        }
        
        button:disabled { 
            background: #666; 
            cursor: not-allowed; 
            transform: none; 
        }
        
        /* Cards responsivos melhorados */
        .cards-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(min(110px, 95vw), 1fr)); 
            gap: 12px; 
            margin-top: 25px; 
            padding: 10px; 
            max-width: 100%; 
        }
        
        .card { 
            background: linear-gradient(145deg, #16213e, #0f1a2e); 
            height: 110px; 
            border-radius: 18px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: clamp(14px, 4vw, 16px); 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            border: 3px solid #0f3460; 
            position: relative; 
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }
        
        .card:hover:not(.used) { 
            transform: scale(1.08) translateY(-4px); 
            border-color: #ff4757; 
            box-shadow: 0 12px 30px rgba(255,71,87,0.4);
        }
        
        .card.used { 
            opacity: 0.5; 
            cursor: not-allowed; 
            border-color: #666; 
            background: linear-gradient(145deg, #333, #222); 
            transform: none;
        }
        
        h1 { 
            margin-bottom: 25px; 
            color: #ff6b7a; 
            font-size: clamp(24px, 8vw, 32px); 
            text-shadow: 0 2px 10px rgba(255,107,122,0.5);
        }
        
        .loading { 
            color: #ff6b7a; 
            font-size: clamp(16px, 5vw, 18px); 
            margin-bottom: 15px; 
        }
        
        /* Modal completamente reescrito e otimizado */
        .modal { 
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.96); 
        }
        
        .modal.active { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 10px; 
        }
        
        .modal-content { 
            background: linear-gradient(145deg, #fff, #f8f9fa); 
            color: #000; 
            padding: 50px 25px 50px 20px; 
            border-radius: 25px; 
            width: min(95vw, 400px); 
            max-height: 85vh; 
            text-align: center; 
            position: relative; 
            animation: popupIn 0.4s cubic-bezier(0.25,0.46,0.45,0.94); 
            box-shadow: 0 25px 60px rgba(0,0,0,0.6); 
            margin: auto; 
            overflow-y: auto;
        }
        
        .role-section {
            margin-bottom: 20px;
        }
        
        .role-label {
            font-size: clamp(14px, 4vw, 16px);
            color: #666;
            font-weight: 500;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .role-value {
            font-size: clamp(18px, 5vw, 24px);
            font-weight: 800;
            color: #000;
            min-height: 28px;
        }
        
        .impostor-role .role-value {
            color: #ff4757 !important;
            text-shadow: 0 2px 8px rgba(255,71,87,0.3);
        }
        
        .role-text {
            font-size: clamp(16px, 4.5vw, 18px);
            color: #333;
            line-height: 1.4;
            margin-top: 15px;
        }
        
        @keyframes popupIn { 
            from { 
                transform: scale(0.7) translateY(30px); 
                opacity: 0; 
            } 
            to { 
                transform: scale(1) translateY(0); 
                opacity: 1; 
            } 
        }
        
        .close-btn { 
            position: absolute !important; 
            top: 12px !important; 
            right: 15px !important; 
            background: #f8f9fa !important; 
            border: 2px solid #dee2e6 !important; 
            border-radius: 50% !important; 
            width: 38px !important; 
            height: 38px !important; 
            font-size: 20px !important; 
            line-height: 1 !important;
            cursor: pointer !important; 
            color: #6c757d !important; 
            display: flex !important; 
            align-items: center !important; 
            justify-content: center !important; 
            font-weight: 900 !important; 
            transition: all 0.2s !important; 
            z-index: 9999 !important; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.15) !important;
        }
        
        .close-btn:hover { 
            background: #ff4757 !important; 
            color: white !important; 
            border-color: #ff3742 !important; 
            transform: scale(1.05) !important;
        }
        
        .close-btn:active { 
            transform: scale(0.95) !important; 
        }
        
        /* Media queries otimizadas */
        @media (max-width: 360px) {
            .cards-grid { 
                grid-template-columns: repeat(3, 1fr); 
                gap: 10px; 
            }
            .card { 
                height: 95px; 
                font-size: 14px; 
            }
            button { 
                padding: 16px 25px; 
                font-size: 16px; 
                min-width: 180px; 
            }
            .toggle-container {
                flex-direction: column;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Tela de Configura√ß√£o -->
        <div id="configScreen" class="screen active">
            <h1>Camale√£o do Gigio</h1>
            
            <!-- Toggle Modo Surpresa -->
            <div class="toggle-container">
                <label class="modo-surpresa">üïµÔ∏è Modo Surpresa</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="modoSurpresa">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div id="loadingMsg" class="loading" style="display:none;">Carregando lugares...</div>
            <div>Jogadores:</div>
            <input type="number" id="numJogadores" min="4" max="15" value="8">
            <div>Impostores:</div>
            <input type="number" id="numImpostores" min="1" max="5" value="2">
            <button id="startBtn" onclick="startGame()" disabled>Carregando...</button>
        </div>

        <!-- Tela dos Cards -->
        <div id="cardsScreen" class="screen">
            <h1>Escolha seu Card</h1>
            <div class="cards-grid" id="cardsGrid"></div>
            <button onclick="resetGame()">Nova Partida</button>
        </div>
    </div>

    <!-- Modal otimizado -->
    <div id="roleModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <div id="roleContent"></div>
        </div>
    </div>

    <script>
        // JSON EMBUTIDO como fallback (12 lugares)
        const lugaresFallback = {
            "Hospital": ["M√©dico", "Enfermeiro", "Paciente", "Recepcionista", "Cirurgi√£o", "Farmac√™utico", "Porteiro"],
        };

        let lugares = lugaresFallback;
        let gameState = null;
        let modoSurpresa = false;

        // Tenta carregar JSON externo, mas usa fallback se falhar
        document.getElementById('loadingMsg').style.display = 'block';
        fetch('lugares.json')
            .then(response => response.json())
            .then(data => {
                lugares = data.lugares || lugaresFallback;
                console.log('Lugares carregados:', Object.keys(lugares).length);
            })
            .catch(err => {
                console.warn('JSON externo n√£o encontrado, usando embutido:', err);
            })
            .finally(() => {
                document.getElementById('loadingMsg').style.display = 'none';
                document.getElementById('startBtn').disabled = false;
                document.getElementById('startBtn').textContent = 'Come√ßar Jogo';
            });

        // Listener para o toggle do Modo Surpresa
        document.getElementById('modoSurpresa').addEventListener('change', function() {
            modoSurpresa = this.checked;
        });

        function startGame() {
            const numJogadores = parseInt(document.getElementById('numJogadores').value);
            const numImpostores = parseInt(document.getElementById('numImpostores').value);

            if (!modoSurpresa && (numImpostores >= numJogadores || numJogadores < 4)) {
                alert('N√∫mero inv√°lido! Jogadores ‚â• 4, Impostores < Jogadores.');
                return;
            }

            // Se Modo Surpresa estiver ativo, todos s√£o impostores
            let papeis;
            if (modoSurpresa) {
                papeis = Array(numJogadores).fill('impostor');
            } else {
                papeis = Array(numImpostores).fill('impostor');
                papeis = papeis.concat(Array(numJogadores - numImpostores).fill('inocente'));
                papeis.sort(() => Math.random() - 0.5);
            }

            const lugaresList = Object.keys(lugares);
            const lugarEscolhido = lugaresList[Math.floor(Math.random() * lugaresList.length)];
            const todasFuncoes = lugares[lugarEscolhido];
            const funcoes = [...todasFuncoes].sort(() => Math.random() - 0.5).slice(0, numJogadores - numImpostores);

            gameState = {
                papeis,
                lugar: lugarEscolhido,
                funcoes,
                usedCards: new Set(),
                modoSurpresa
            };

            document.getElementById('configScreen').classList.remove('active');
            document.getElementById('cardsScreen').classList.add('active');
            renderCards();
        }

        function renderCards() {
            const grid = document.getElementById('cardsGrid');
            grid.innerHTML = '';
            for (let i = 0; i < gameState.papeis.length; i++) {
                const card = document.createElement('div');
                card.className = `card ${gameState.usedCards.has(i) ? 'used' : ''}`;
                card.textContent = gameState.usedCards.has(i) ? '‚úì' : '?';
                if (!gameState.usedCards.has(i)) {
                    card.onclick = () => openModal(i);
                }
                grid.appendChild(card);
            }
        }

        function openModal(index) {
            gameState.usedCards.add(index);
            renderCards();

            const isImpostor = gameState.papeis[index] === 'impostor';
            const content = document.getElementById('roleContent');

            if (gameState.modoSurpresa || isImpostor) {
                content.innerHTML = `
                    <div class="role-section impostor-role">
                        <div class="role-label">Local:</div>
                        <div class="role-value">?</div>
                    </div>
                    <div class="role-section">
                        <div class="role-label">Fun√ß√£o:</div>
                        <div class="role-value">IMPOSTOR</div>
                    </div>
                    <div class="role-text">Voc√™ √© o impostor!</div>
                `;
            } else {
                const funcaoIndex = gameState.papeis.slice(0, index).filter(p => p === 'inocente').length;
                content.innerHTML = `
                    <div class="role-section">
                        <div class="role-label">Local:</div>
                        <div class="role-value">${gameState.lugar}</div>
                    </div>
                    <div class="role-section">
                        <div class="role-label">Fun√ß√£o:</div>
                        <div class="role-value">${gameState.funcoes[funcaoIndex]}</div>
                    </div>
                `;
            }

            document.getElementById('roleModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('roleModal').classList.remove('active');
        }

        function resetGame() {
            gameState = null;
            modoSurpresa = false;
            document.getElementById('modoSurpresa').checked = false;
            document.getElementById('cardsScreen').classList.remove('active');
            document.getElementById('configScreen').classList.add('active');
        }

        document.getElementById('roleModal').onclick = function(e) {
            if (e.target === this) closeModal();
        };
    </script>
</body>
</html>
